#ifndef ENIGMA_H
#define ENIGMA_H

#include <stdint.h>

typedef struct enigma_t {
  uint64_t counter;
  uint8_t **rotors;
} enigma_t;

#define NUM_ROTORS 3
#define ALPHABET_SIZE 256

#define R_1 7
#define R_2 3
#define R_3 9

static const uint8_t ALPHABET[ALPHABET_SIZE] = {
    0,   1,   2,   3,   4,   5,   6,   7,   8,   9,   10,  11,  12,  13,  14,
    15,  16,  17,  18,  19,  20,  21,  22,  23,  24,  25,  26,  27,  28,  29,
    30,  31,  32,  33,  34,  35,  36,  37,  38,  39,  40,  41,  42,  43,  44,
    45,  46,  47,  48,  49,  50,  51,  52,  53,  54,  55,  56,  57,  58,  59,
    60,  61,  62,  63,  64,  65,  66,  67,  68,  69,  70,  71,  72,  73,  74,
    75,  76,  77,  78,  79,  80,  81,  82,  83,  84,  85,  86,  87,  88,  89,
    90,  91,  92,  93,  94,  95,  96,  97,  98,  99,  100, 101, 102, 103, 104,
    105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119,
    120, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134,
    135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147, 148, 149,
    150, 151, 152, 153, 154, 155, 156, 157, 158, 159, 160, 161, 162, 163, 164,
    165, 166, 167, 168, 169, 170, 171, 172, 173, 174, 175, 176, 177, 178, 179,
    180, 181, 182, 183, 184, 185, 186, 187, 188, 189, 190, 191, 192, 193, 194,
    195, 196, 197, 198, 199, 200, 201, 202, 203, 204, 205, 206, 207, 208, 209,
    210, 211, 212, 213, 214, 215, 216, 217, 218, 219, 220, 221, 222, 223, 224,
    225, 226, 227, 228, 229, 230, 231, 232, 233, 234, 235, 236, 237, 238, 239,
    240, 241, 242, 243, 244, 245, 246, 247, 248, 249, 250, 251, 252, 253, 254,
    255};

static const uint8_t REFLECTOR[256] = {
    255, 254, 253, 252, 251, 250, 249, 248, 247, 246, 245, 244, 243, 242, 241,
    240, 239, 238, 237, 236, 235, 234, 233, 232, 231, 230, 229, 228, 227, 226,
    225, 224, 223, 222, 221, 220, 219, 218, 217, 216, 215, 214, 213, 212, 211,
    210, 209, 208, 207, 206, 205, 204, 203, 202, 201, 200, 199, 198, 197, 196,
    195, 194, 193, 192, 191, 190, 189, 188, 187, 186, 185, 184, 183, 182, 181,
    180, 179, 178, 177, 176, 175, 174, 173, 172, 171, 170, 169, 168, 167, 166,
    165, 164, 163, 162, 161, 160, 159, 158, 157, 156, 155, 154, 153, 152, 151,
    150, 149, 148, 147, 146, 145, 144, 143, 142, 141, 140, 139, 138, 137, 136,
    135, 134, 133, 132, 131, 130, 129, 128, 127, 126, 125, 124, 123, 122, 121,
    120, 119, 118, 117, 116, 115, 114, 113, 112, 111, 110, 109, 108, 107, 106,
    105, 104, 103, 102, 101, 100, 99,  98,  97,  96,  95,  94,  93,  92,  91,
    90,  89,  88,  87,  86,  85,  84,  83,  82,  81,  80,  79,  78,  77,  76,
    75,  74,  73,  72,  71,  70,  69,  68,  67,  66,  65,  64,  63,  62,  61,
    60,  59,  58,  57,  56,  55,  54,  53,  52,  51,  50,  49,  48,  47,  46,
    45,  44,  43,  42,  41,  40,  39,  38,  37,  36,  35,  34,  33,  32,  31,
    30,  29,  28,  27,  26,  25,  24,  23,  22,  21,  20,  19,  18,  17,  16,
    15,  14,  13,  12,  11,  10,  9,   8,   7,   6,   5,   4,   3,   2,   1,
    0};

static const uint8_t ROTORS[3][256] = {
    {99,  151, 11,  105, 94,  29,  47,  241, 199, 129, 110, 66,  4,   18,  22,
     198, 101, 67,  221, 146, 124, 69,  136, 147, 113, 1,   226, 203, 39,  36,
     90,  17,  182, 72,  126, 58,  248, 59,  177, 62,  19,  96,  202, 42,  68,
     21,  175, 119, 32,  188, 160, 170, 112, 210, 116, 181, 239, 164, 149, 172,
     200, 15,  118, 3,   190, 255, 135, 46,  180, 54,  52,  83,  228, 41,  214,
     211, 227, 31,  2,   217, 10,  60,  38,  81,  13,  33,  225, 167, 131, 76,
     187, 243, 254, 45,  234, 197, 158, 56,  91,  148, 28,  205, 208, 144, 88,
     93,  130, 16,  65,  231, 133, 121, 220, 191, 125, 6,   123, 14,  152, 251,
     159, 57,  24,  34,  224, 70,  154, 128, 84,  207, 78,  230, 223, 246, 139,
     87,  106, 168, 183, 51,  44,  103, 222, 61,  150, 71,  82,  192, 253, 75,
     173, 132, 193, 186, 237, 25,  142, 79,  73,  174, 247, 218, 184, 238, 235,
     117, 171, 122, 49,  114, 40,  141, 77,  5,   178, 80,  162, 85,  26,  169,
     30,  7,   107, 55,  166, 153, 140, 156, 165, 161, 194, 189, 43,  53,  115,
     250, 100, 102, 74,  109, 23,  89,  27,  37,  127, 86,  120, 252, 209, 92,
     137, 233, 35,  145, 201, 143, 98,  9,   48,  111, 63,  97,  108, 216, 213,
     185, 12,  196, 50,  249, 219, 134, 236, 242, 244, 157, 95,  204, 240, 195,
     179, 138, 229, 155, 163, 64,  206, 176, 232, 212, 20,  245, 8,   104, 0,
     215},
    {14,  23,  169, 224, 122, 140, 155, 95,  204, 233, 36,  142, 62,  100, 75,
     113, 27,  152, 51,  46,  44,  53,  68,  237, 125, 225, 165, 192, 180, 214,
     2,   25,  89,  118, 11,  210, 6,   84,  212, 41,  254, 136, 52,  39,  76,
     191, 116, 35,  186, 193, 227, 72,  168, 242, 10,  24,  34,  197, 202, 170,
     45,  103, 149, 203, 86,  129, 158, 18,  31,  99,  104, 126, 3,   240, 229,
     231, 156, 245, 101, 243, 188, 108, 43,  187, 236, 127, 150, 250, 253, 13,
     160, 164, 77,  185, 209, 15,  198, 163, 4,   244, 28,  48,  133, 21,  157,
     255, 67,  137, 205, 206, 178, 109, 7,   132, 196, 182, 207, 222, 194, 12,
     115, 123, 200, 55,  235, 97,  218, 57,  96,  90,  49,  65,  159, 42,  56,
     98,  110, 215, 1,   189, 208, 61,  161, 226, 106, 8,   246, 114, 88,  117,
     22,  199, 179, 241, 111, 121, 181, 144, 124, 134, 20,  37,  5,   252, 216,
     173, 232, 66,  219, 148, 139, 251, 92,  195, 85,  59,  213, 82,  175, 47,
     80,  94,  131, 73,  230, 220, 171, 107, 87,  221, 190, 81,  239, 177, 91,
     184, 38,  69,  64,  154, 143, 141, 217, 247, 70,  145, 153, 29,  9,   223,
     147, 228, 174, 58,  183, 83,  16,  201, 17,  93,  176, 74,  30,  211, 54,
     167, 40,  248, 0,   63,  151, 238, 32,  249, 146, 112, 71,  172, 128, 166,
     26,  162, 135, 105, 50,  138, 102, 130, 78,  19,  60,  234, 33,  119, 120,
     79},
    {72,  177, 246, 233, 66,  247, 178, 156, 73,  125, 51,  16,  218, 202, 104,
     6,   193, 161, 77,  207, 215, 220, 236, 174, 53,  176, 20,  91,  107, 126,
     5,   44,  48,  248, 22,  64,  67,  240, 204, 106, 63,  223, 40,  180, 250,
     69,  224, 243, 46,  205, 183, 15,  254, 167, 137, 90,  43,  92,  52,  203,
     33,  209, 189, 200, 120, 57,  56,  172, 68,  140, 101, 27,  232, 153, 244,
     61,  81,  4,   11,  197, 159, 210, 14,  23,  94,  164, 146, 96,  108, 231,
     144, 170, 199, 54,  65,  36,  131, 49,  76,  149, 97,  154, 71,  212, 122,
     186, 155, 95,  253, 115, 173, 157, 28,  138, 10,  171, 187, 2,   75,  238,
     8,   152, 128, 113, 39,  198, 239, 228, 191, 82,  70,  214, 3,   237, 0,
     194, 32,  47,  117, 17,  24,  132, 165, 62,  42,  105, 89,  252, 136, 196,
     141, 133, 192, 109, 166, 185, 175, 143, 112, 74,  80,  251, 79,  78,  208,
     85,  124, 249, 211, 188, 34,  119, 58,  114, 50,  18,  206, 83,  123, 221,
     99,  110, 213, 182, 241, 158, 226, 60,  26,  151, 30,  216, 87,  201, 162,
     235, 45,  111, 179, 242, 88,  160, 118, 245, 225, 31,  59,  29,  145, 21,
     9,   102, 163, 98,  234, 103, 255, 37,  93,  195, 116, 230, 25,  100, 13,
     127, 142, 150, 86,  139, 190, 147, 129, 181, 35,  1,   148, 134, 184, 135,
     121, 12,  19,  217, 169, 38,  219, 41,  55,  7,   229, 168, 227, 84,  222,
     130}};

static const uint8_t PLUGBOARD[256] = {
    128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142,
    143, 144, 145, 146, 147, 148, 149, 150, 151, 152, 153, 154, 155, 156, 157,
    158, 159, 160, 161, 162, 163, 164, 165, 166, 167, 168, 169, 170, 171, 172,
    173, 174, 175, 176, 177, 178, 179, 180, 181, 182, 183, 184, 185, 186, 187,
    188, 189, 190, 191, 192, 193, 194, 195, 196, 197, 198, 199, 200, 201, 202,
    203, 204, 205, 206, 207, 208, 209, 210, 211, 212, 213, 214, 215, 216, 217,
    218, 219, 220, 221, 222, 223, 224, 225, 226, 227, 228, 229, 230, 231, 232,
    233, 234, 235, 236, 237, 238, 239, 240, 241, 242, 243, 244, 245, 246, 247,
    248, 249, 250, 251, 252, 253, 254, 255, 0,   1,   2,   3,   4,   5,   6,
    7,   8,   9,   10,  11,  12,  13,  14,  15,  16,  17,  18,  19,  20,  21,
    22,  23,  24,  25,  26,  27,  28,  29,  30,  31,  32,  33,  34,  35,  36,
    37,  38,  39,  40,  41,  42,  43,  44,  45,  46,  47,  48,  49,  50,  51,
    52,  53,  54,  55,  56,  57,  58,  59,  60,  61,  62,  63,  64,  65,  66,
    67,  68,  69,  70,  71,  72,  73,  74,  75,  76,  77,  78,  79,  80,  81,
    82,  83,  84,  85,  86,  87,  88,  89,  90,  91,  92,  93,  94,  95,  96,
    97,  98,  99,  100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111,
    112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126,
    127};

void initial_shift(enigma_t* enigma, const uint8_t rn, const int count);
void enigma_rotor_shift(enigma_t* enigma, const uint8_t rn);
enigma_t *enigma_init();
void enigma_free(enigma_t *enigma);
uint8_t enigma_encrypt(enigma_t *enigma, const uint8_t c);

#endif  // ENIGMA_H
